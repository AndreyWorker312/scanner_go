<!DOCTYPE html>
<html>
<head>
  <title>Network Scanner - –ì–ª–∞–≤–Ω–∞—è</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
    }

    /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */
    .sidebar {
      width: 250px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 0 20px 30px 20px;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 20px;
    }

    .sidebar-header h1 {
      color: #333;
      font-size: 24px;
      font-weight: 600;
      text-align: center;
    }

    .sidebar-header p {
      color: #666;
      font-size: 14px;
      text-align: center;
      margin-top: 5px;
    }

    .nav-menu {
      list-style: none;
    }

    .nav-item {
      margin: 5px 0;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      color: #555;
      text-decoration: none;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .nav-link:hover {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      border-left-color: #667eea;
    }

    .nav-link.active {
      background: rgba(102, 126, 234, 0.15);
      color: #667eea;
      border-left-color: #667eea;
      font-weight: 600;
    }

    .nav-icon {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      font-size: 18px;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
    .main-content {
      flex: 1;
      margin-left: 250px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* –°–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü */
    .page {
      display: none;
      flex: 1;
      padding: 20px;
    }

    .page.active {
      display: flex;
      flex-direction: column;
    }

    /* –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */
    .welcome-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 60px 40px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      margin: auto;
      width: 100%;
    }

    .welcome-card h2 {
      color: #333;
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .welcome-card p {
      color: #666;
      font-size: 18px;
      line-height: 1.6;
      margin-bottom: 30px;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 40px;
    }

    .feature-card {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      padding: 30px 20px;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }

    .feature-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    .feature-title {
      color: #333;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .feature-description {
      color: #666;
      font-size: 14px;
      line-height: 1.5;
    }

    /* –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è */
    .connection-status {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 14px;
      z-index: 1001;
    }

    .connection-status.connected {
      background: #28a745;
      color: white;
    }

    .connection-status.disconnected {
      background: #dc3545;
      color: white;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .welcome-card {
        padding: 40px 20px;
      }

      .welcome-card h2 {
        font-size: 28px;
      }

      .feature-grid {
        grid-template-columns: 1fr;
      }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è ARP —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    .arp-page {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }

    .arp-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .arp-header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .arp-controls {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .button-group {
      margin: 10px 0;
    }

    button {
      margin: 5px;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-primary {
      background: #007bff;
      color: white;
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-info {
      background: #17a2b8;
      color: white;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .form-group {
      margin: 15px 0;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: inherit;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-weight: bold;
    }

    .status.connected {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status.disconnected {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .history-container {
      display: flex;
      gap: 20px;
      justify-content: flex-start;
      align-items: flex-start;
      width: 100%;
      max-width: 100%;
      padding: 0;
      margin: 0;
    }

    .history-panel { 
      flex: 1;
      width: 100%;
      max-width: 100%;
      background: white; 
      border-radius: 8px; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow: hidden;
      margin: 0;
    }

    .history-header { 
      background: #343a40; 
      color: white; 
      padding: 15px; 
      font-weight: bold; 
      font-size: 16px;
    }

    .history-header.online {
      background: #28a745;
    }

    .history-header.offline {
      background: #dc3545;
    }

    .history-content { 
      padding: 20px; 
      max-height: 600px; 
      overflow-y: auto;
      width: 100%;
    }

    .scan-result { 
      border: 1px solid #dee2e6; 
      border-radius: 6px; 
      margin-bottom: 15px; 
      background: #f8f9fa;
    }

    .scan-header { 
      background: #e9ecef; 
      padding: 10px 15px; 
      font-weight: bold; 
      border-bottom: 1px solid #dee2e6;
    }

    .scan-body {
      padding: 15px;
    }

    .device-list { 
      max-height: 200px; 
      overflow-y: auto; 
      margin-top: 10px;
    }

    .device-item { 
      padding: 5px 10px; 
      margin: 2px 0; 
      border-radius: 3px; 
      font-family: monospace; 
      font-size: 12px;
    }

    .device-online {
      background: #d4edda;
      color: #155724;
    }

    .device-offline {
      background: #f8d7da;
      color: #721c24;
    }

    .stats { 
      display: flex; 
      gap: 20px; 
      margin-top: 10px;
    }

    .stat-item { 
      background: #007bff; 
      color: white; 
      padding: 8px 12px; 
      border-radius: 4px; 
      font-size: 12px;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è ICMP —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    .icmp-page {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è Nmap —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    .nmap-page {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }

    .scan-type-card {
      background: #f8f9fa;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .scan-type-card:hover {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.05);
    }

    .scan-type-card.active {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.1);
    }

    .scan-type-icon {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .scan-type-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .scan-type-description {
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>
  <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
  <div id="connectionStatus" class="connection-status disconnected">
    üî¥ –û—Ç–∫–ª—é—á–µ–Ω–æ
  </div>

  <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <h1>üîç Network Scanner</h1>
      <p>–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–∫–∞–Ω–µ—Ä —Å–µ—Ç–∏</p>
    </div>
    <ul class="nav-menu">
      <li class="nav-item">
        <a href="#" class="nav-link active" data-page="home">
          <span class="nav-icon">üè†</span>
          –ì–ª–∞–≤–Ω–∞—è
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-page="arp">
          <span class="nav-icon">üîç</span>
          ARP –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-page="icmp">
          <span class="nav-icon">üì°</span>
          ICMP Ping
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-page="nmap">
          <span class="nav-icon">‚ö°</span>
          Nmap –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-page="tcp">
          <span class="nav-icon">üîå</span>
          TCP –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-page="arp-history">
          <span class="nav-icon">üìä</span>
          ARP –ò—Å—Ç–æ—Ä–∏—è
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-page="icmp-history">
          <span class="nav-icon">üìä</span>
          ICMP –ò—Å—Ç–æ—Ä–∏—è
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-page="nmap-history">
          <span class="nav-icon">üìä</span>
          Nmap –ò—Å—Ç–æ—Ä–∏—è
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-page="tcp-history">
          <span class="nav-icon">üìä</span>
          TCP –ò—Å—Ç–æ—Ä–∏—è
        </a>
      </li>
    </ul>
  </nav>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="main-content">
    <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div id="home" class="page active">
      <div class="welcome-card">
        <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Network Scanner</h2>
        <p>–ú–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ç–∏–ø —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ –º–µ–Ω—é —Å–ª–µ–≤–∞.</p>
        
        <div class="feature-grid">
          <div class="feature-card" onclick="showPage('arp')">
            <div class="feature-icon">üîç</div>
            <div class="feature-title">ARP –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="feature-description">–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ –ø–æ MAC-–∞–¥—Ä–µ—Å–∞–º</div>
          </div>
          
          <div class="feature-card" onclick="showPage('icmp')">
            <div class="feature-icon">üì°</div>
            <div class="feature-title">ICMP Ping</div>
            <div class="feature-description">–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ö–æ—Å—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é ping</div>
          </div>
          
          <div class="feature-card" onclick="showPage('nmap')">
            <div class="feature-icon">‚ö°</div>
            <div class="feature-title">Nmap –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="feature-description">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –û–°</div>
          </div>
          
          <div class="feature-card" onclick="showPage('tcp')">
            <div class="feature-icon">üîå</div>
            <div class="feature-title">TCP –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="feature-description">–ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ TCP –∫–∞–Ω–∞–ª–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–æ–≤</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ARP —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div id="arp" class="page arp-page">
      <div class="arp-container">
        <div class="arp-header">
    <h1>üåê Network Scanner - ARP Scanner</h1>
    <p>Real-time network device discovery and monitoring</p>
  </div>

        <div class="arp-controls">
    <div class="button-group">
      <button onclick="connect()" class="btn-success">Connect</button>
      <button onclick="disconnect()" id="disconnectBtn" class="btn-danger" disabled>Disconnect</button>
      <button onclick="viewARPHistory()" class="btn-info">View History</button>
      <button onclick="clearHistory()" class="btn-secondary">Clear History</button>
    </div>

    <div id="status" class="status disconnected">Disconnected</div>

    <div style="display: flex; gap: 20px;">
      <div class="form-group" style="flex: 1;">
        <label for="interfaceSelect">Network Interface:</label>
        <select id="interfaceSelect">
          <option value="wlo1">wlo1 (WiFi)</option>
          <option value="eth0">eth0 (Ethernet)</option>
          <option value="enp0s3">enp0s3</option>
        </select>
      </div>
      
      <div class="form-group" style="flex: 1;">
        <label for="ipRangeInput">IP Range:</label>
        <input type="text" id="ipRangeInput" value="10.20.5.0/28" placeholder="e.g., 192.168.1.0/24">
      </div>
      
      <div class="form-group" style="flex: 0 0 auto; display: flex; align-items: end;">
        <button onclick="startScan()" id="scanBtn" class="btn-primary" disabled>Start Scan</button>
      </div>
    </div>
  </div>

  <div class="history-container">
    <div class="history-panel">
      <div class="history-header online">üü¢ Online Devices</div>
      <div class="history-content" id="onlineHistory">
        <p style="text-align: center; color: #666; margin-top: 50px;">No online devices found yet</p>
      </div>
    </div>
    
    <div class="history-panel">
      <div class="history-header offline">üî¥ Offline Devices</div>
      <div class="history-content" id="offlineHistory">
        <p style="text-align: center; color: #666; margin-top: 50px;">No offline devices found yet</p>
            </div>
      </div>
    </div>
  </div>
</div>

    <!-- ICMP —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div id="icmp" class="page icmp-page">
      <div class="arp-container">
        <div class="arp-header">
          <h1>üì° Network Scanner - ICMP Ping</h1>
          <p>Real-time host availability checking and network diagnostics</p>
        </div>

        <div class="arp-controls">
          <div class="button-group">
            <button onclick="connectIcmp()" class="btn-success">Connect</button>
            <button onclick="disconnectIcmp()" id="disconnectBtnIcmp" class="btn-danger" disabled>Disconnect</button>
            <button onclick="viewICMPHistory()" class="btn-info">View History</button>
            <button onclick="clearIcmpHistory()" class="btn-secondary">Clear History</button>
          </div>

          <div id="statusIcmp" class="status disconnected">Disconnected</div>

          <div style="display: flex; gap: 20px;">
            <div class="form-group" style="flex: 2;">
              <label for="targetsInput">Target Hosts (one per line):</label>
              <textarea id="targetsInput" rows="4" placeholder="8.8.8.8&#10;google.com&#10;192.168.1.1&#10;yandex.ru">8.8.8.8
google.com
192.168.1.1</textarea>
            </div>
            
            <div class="form-group" style="flex: 1;">
              <label for="pingCountSelect">Ping Count:</label>
              <select id="pingCountSelect">
                <option value="1">1 packet (quick)</option>
                <option value="4" selected>4 packets (standard)</option>
                <option value="10">10 packets (detailed)</option>
                <option value="20">20 packets (thorough)</option>
              </select>
            </div>
            
            <div class="form-group" style="flex: 0 0 auto; display: flex; align-items: end;">
              <button onclick="startIcmpScan()" id="scanBtnIcmp" class="btn-primary" disabled>Start Ping</button>
            </div>
          </div>

          <div class="button-group" style="margin-top: 15px;">
            <button onclick="addQuickTarget('8.8.8.8')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Google DNS</button>
            <button onclick="addQuickTarget('1.1.1.1')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Cloudflare</button>
            <button onclick="addQuickTarget('google.com')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Google</button>
            <button onclick="addQuickTarget('192.168.1.1')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Router</button>
            <button onclick="addQuickTarget('127.0.0.1')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Localhost</button>
          </div>
        </div>

        <div class="history-container">
          <div class="history-panel">
            <div class="history-header online">üü¢ Ping Results</div>
            <div class="history-content" id="icmpResults">
              <p style="text-align: center; color: #666; margin-top: 50px;">No ping results yet</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Nmap —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div id="nmap" class="page nmap-page">
      <div class="arp-container">
        <div class="arp-header">
          <h1>‚ö° Network Scanner - Nmap</h1>
          <p>Advanced port scanning and OS detection</p>
        </div>

        <div class="arp-controls">
          <div class="button-group">
            <button onclick="connectNmap()" class="btn-success">Connect</button>
            <button onclick="disconnectNmap()" id="disconnectBtnNmap" class="btn-danger" disabled>Disconnect</button>
            <button onclick="viewNmapHistory()" class="btn-info">View History</button>
            <button onclick="clearNmapHistory()" class="btn-secondary">Clear History</button>
          </div>

          <div id="statusNmap" class="status disconnected">Disconnected</div>

          <div style="display: flex; gap: 20px; margin-bottom: 20px;">
            <div class="form-group" style="flex: 1;">
              <label for="targetIPNmap">Target IP/Host:</label>
              <input type="text" id="targetIPNmap" placeholder="192.168.1.1" value="192.168.1.1">
            </div>
            
            <div class="form-group" style="flex: 0 0 auto; display: flex; align-items: end;">
              <button onclick="startNmapScan()" id="scanBtnNmap" class="btn-primary" disabled>Start Scan</button>
            </div>
          </div>

          <!-- –°–µ–ª–µ–∫—Ç–æ—Ä —Ç–∏–ø–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
          <div class="form-group">
            <label>Scan Type:</label>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 10px;">
              <div class="scan-type-card" data-type="tcp_scan">
                <div class="scan-type-icon">üîå</div>
                <div class="scan-type-title">TCP Scan</div>
                <div class="scan-type-description">Connect scan for TCP ports</div>
              </div>
              
              <div class="scan-type-card" data-type="udp_scan">
                <div class="scan-type-icon">üì°</div>
                <div class="scan-type-title">UDP Scan</div>
                <div class="scan-type-description">UDP port scanning</div>
              </div>
              
              <div class="scan-type-card" data-type="os_detection">
                <div class="scan-type-icon">üíª</div>
                <div class="scan-type-title">OS Detection</div>
                <div class="scan-type-description">Detect operating system</div>
              </div>
              
              <div class="scan-type-card" data-type="host_discovery">
                <div class="scan-type-icon">üîç</div>
                <div class="scan-type-title">Host Discovery</div>
                <div class="scan-type-description">Check if host is alive</div>
              </div>
            </div>
          </div>

          <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è TCP/UDP) -->
          <div id="portsSettings" class="form-group" style="display: none;">
            <label for="portsInput">Ports to scan:</label>
            <input type="text" id="portsInput" placeholder="80,443,22,21" value="80,443,22,21">
            <div style="margin-top: 10px;">
              <button onclick="setQuickPorts('common')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;">Common</button>
              <button onclick="setQuickPorts('web')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;">Web</button>
              <button onclick="setQuickPorts('all')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">All</button>
            </div>
          </div>
        </div>

        <div class="history-container">
          <div class="history-panel">
            <div class="history-header online">‚ö° Nmap Results</div>
            <div class="history-content" id="nmapResults">
              <p style="text-align: center; color: #666; margin-top: 50px;">No scan results yet</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TCP —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div id="tcp" class="page nmap-page">
      <div class="arp-container">
        <div class="arp-header">
          <h1>üîå Network Scanner - TCP Banner Grabber</h1>
          <p>Read data from TCP channel and get service banners</p>
        </div>

        <div class="arp-controls">
          <div class="button-group">
            <button onclick="connectTcp()" class="btn-success">Connect</button>
            <button onclick="disconnectTcp()" id="disconnectBtnTcp" class="btn-danger" disabled>Disconnect</button>
            <button onclick="viewTcpHistory()" class="btn-info">View History</button>
            <button onclick="clearTcpHistory()" class="btn-secondary">Clear History</button>
          </div>

          <div id="statusTcp" class="status disconnected">Disconnected</div>

          <div style="display: flex; gap: 20px;">
            <div class="form-group" style="flex: 1;">
              <label for="targetHostTcp">Target Host:</label>
              <input type="text" id="targetHostTcp" placeholder="telehack.com" value="telehack.com">
            </div>
            
            <div class="form-group" style="flex: 1;">
              <label for="targetPortTcp">Port:</label>
              <input type="text" id="targetPortTcp" placeholder="23" value="23">
            </div>
            
            <div class="form-group" style="flex: 0 0 auto; display: flex; align-items: end;">
              <button onclick="startTcpScan()" id="scanBtnTcp" class="btn-primary" disabled>Start Scan</button>
            </div>
          </div>

          <div class="button-group" style="margin-top: 15px;">
            <button onclick="setQuickTcp('telehack.com', '23')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Telehack</button>
            <button onclick="setQuickTcp('google.com', '80')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Google HTTP</button>
            <button onclick="setQuickTcp('google.com', '443')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Google HTTPS</button>
            <button onclick="setQuickTcp('192.168.1.1', '80')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">Router</button>
          </div>
        </div>

        <div class="history-container">
          <div class="history-panel">
            <div class="history-header online">üîå TCP Results</div>
            <div class="history-content" id="tcpResults">
              <p style="text-align: center; color: #666; margin-top: 50px;">No TCP scan results yet</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- ARP History —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
  <div id="arp-history" class="page" style="display: none;">
    <div class="arp-container">
      <div class="arp-header">
        <h1>üìä ARP Scan History</h1>
        <p>View and manage ARP scanning history</p>
      </div>
      
      <div class="arp-controls">
        <div class="button-group">
          <button onclick="showPage('arp')" class="btn-secondary">‚Üê Back to ARP Scanner</button>
          <button onclick="loadARPHistory()" class="btn-primary">Refresh</button>
          <button onclick="clearARPHistory()" class="btn-danger">Clear All History</button>
        </div>
      </div>

      <div class="history-container">
        <div class="history-panel">
          <div class="history-header online">üìã ARP History Records</div>
          <div class="history-content" id="arpHistoryContent">
            <p style="text-align: center; color: #666; margin-top: 50px;">Loading history...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ICMP History —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
  <div id="icmp-history" class="page" style="display: none;">
    <div class="arp-container">
      <div class="arp-header">
        <h1>üìä ICMP Ping History</h1>
        <p>View and manage ICMP ping history</p>
      </div>
      
      <div class="arp-controls">
        <div class="button-group">
          <button onclick="showPage('icmp')" class="btn-secondary">‚Üê Back to ICMP Scanner</button>
          <button onclick="loadICMPHistory()" class="btn-primary">Refresh</button>
          <button onclick="clearICMPHistory()" class="btn-danger">Clear All History</button>
        </div>
      </div>

      <div class="history-container">
        <div class="history-panel">
          <div class="history-header online">üìã ICMP History Records</div>
          <div class="history-content" id="icmpHistoryContent">
            <p style="text-align: center; color: #666; margin-top: 50px;">Loading history...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Nmap History —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
  <div id="nmap-history" class="page" style="display: none;">
    <div class="arp-container">
      <div class="arp-header">
        <h1>üìä Nmap Scan History</h1>
        <p>View and manage Nmap scanning history</p>
      </div>
      
      <div class="arp-controls">
        <div class="button-group">
          <button onclick="showPage('nmap')" class="btn-secondary">‚Üê Back to Nmap Scanner</button>
          <button onclick="loadNmapHistory()" class="btn-primary">Refresh</button>
          <button onclick="clearNmapHistory()" class="btn-danger">Clear All History</button>
        </div>
      </div>

      <div class="history-container">
        <div class="history-panel">
          <div class="history-header online">üìã Nmap History Records</div>
          <div class="history-content" id="nmapHistoryContent">
            <p style="text-align: center; color: #666; margin-top: 50px;">Loading history...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- TCP History —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
  <div id="tcp-history" class="page" style="display: none;">
    <div class="arp-container">
      <div class="arp-header">
        <h1>üìä TCP Scan History</h1>
        <p>View and manage TCP scanning history</p>
      </div>
      
      <div class="arp-controls">
        <div class="button-group">
          <button onclick="showPage('tcp')" class="btn-secondary">‚Üê Back to TCP Scanner</button>
          <button onclick="loadTcpHistory()" class="btn-primary">Refresh</button>
          <button onclick="clearTcpHistory()" class="btn-danger">Clear All History</button>
        </div>
      </div>

      <div class="history-container">
        <div class="history-panel">
          <div class="history-header online">üìã TCP History Records</div>
          <div class="history-content" id="tcpHistoryContent">
            <p style="text-align: center; color: #666; margin-top: 50px;">Loading history...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è ARP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
  let socket = null;
    let socketIcmp = null;
  let scanHistory = [];
    let icmpHistory = [];

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Nmap —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
    let socketNmap = null;
    let nmapHistory = [];
    let selectedScanType = null;

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è TCP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
    let socketTcp = null;
    let tcpHistory = [];

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
    function showPage(pageId) {
      // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
        page.style.display = 'none';
      });
      
      // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        targetPage.classList.add('active');
        targetPage.style.display = 'flex';
      }
      
      // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –º–µ–Ω—é
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      const navLink = document.querySelector(`[data-page="${pageId}"]`);
      if (navLink) {
        navLink.classList.add('active');
      }

      // –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WebSocket –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      if (pageId === 'arp' && !socket) {
        setTimeout(connect, 500);
      }
      if (pageId === 'icmp' && !socketIcmp) {
        setTimeout(connectIcmp, 500);
      }
      if (pageId === 'tcp' && !socketTcp) {
        setTimeout(connectTcp, 500);
      }
      
      // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
      updateGlobalConnectionStatus();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –º–µ–Ω—é
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const pageId = link.getAttribute('data-page');
        showPage(pageId);
      });
    });

    // ARP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
  const statusElement = document.getElementById('status');
  const disconnectBtn = document.getElementById('disconnectBtn');
  const scanBtn = document.getElementById('scanBtn');
  const interfaceSelect = document.getElementById('interfaceSelect');
  const ipRangeInput = document.getElementById('ipRangeInput');
  const onlineHistory = document.getElementById('onlineHistory');
  const offlineHistory = document.getElementById('offlineHistory');

  function updateStatus(connected) {
    if (connected) {
      statusElement.textContent = '‚úÖ Connected to WebSocket';
      statusElement.className = 'status connected';
      disconnectBtn.disabled = false;
      scanBtn.disabled = false;
    } else {
      statusElement.textContent = '‚ùå Disconnected';
      statusElement.className = 'status disconnected';
      disconnectBtn.disabled = true;
      scanBtn.disabled = true;
    }
      updateGlobalConnectionStatus();
  }

  function addScanToHistory(scanData) {
    console.log('addScanToHistory called with:', scanData);
    const timestamp = new Date().toLocaleTimeString();
    const scanId = Date.now();
    
    const scanResult = {
      id: scanId,
      timestamp: timestamp,
      interface: scanData.interface_name || interfaceSelect.value,
      ipRange: scanData.ip_range || ipRangeInput.value,
      totalCount: scanData.TotalCount || scanData.total_count || 0,
      onlineCount: scanData.OnlineCount || scanData.online_count || 0,
      offlineCount: scanData.OfflineCount || scanData.offline_count || 0,
      onlineDevices: scanData.OnlineDevices || scanData.online_devices || [],
      offlineDevices: scanData.OfflineDevices || scanData.offline_devices || []
    };
    
    scanHistory.unshift(scanResult);
      if (scanHistory.length > 10) scanHistory.pop();
    
    updateHistoryDisplay();
  }

  function updateHistoryDisplay() {
    onlineHistory.innerHTML = '';
    offlineHistory.innerHTML = '';
    
    if (scanHistory.length === 0) {
      onlineHistory.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">No scans performed yet</p>';
      offlineHistory.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">No scans performed yet</p>';
      return;
    }
    
    scanHistory.forEach((scan, index) => {
      if (scan.onlineCount > 0) {
        const onlinePanel = createScanPanel(scan, 'online');
        onlineHistory.appendChild(onlinePanel);
      }
      
      if (scan.offlineCount > 0) {
        const offlinePanel = createScanPanel(scan, 'offline');
        offlineHistory.appendChild(offlinePanel);
      }
    });
    
    if (onlineHistory.children.length === 0) {
      onlineHistory.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">No online devices found</p>';
    }
    if (offlineHistory.children.length === 0) {
      offlineHistory.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">No offline devices found</p>';
    }
  }

  function createScanPanel(scan, type) {
    const panel = document.createElement('div');
    panel.className = 'scan-result';
    
    const header = document.createElement('div');
    header.className = 'scan-header';
    header.innerHTML = `
      <div>üì° ${scan.timestamp} - ${scan.interface}</div>
      <div style="font-size: 12px; font-weight: normal; margin-top: 2px;">${scan.ipRange}</div>
    `;
    
    const body = document.createElement('div');
    body.className = 'scan-body';
    
    const stats = document.createElement('div');
    stats.className = 'stats';
    stats.innerHTML = `
      <div class="stat-item">Total: ${scan.totalCount}</div>
      <div class="stat-item" style="background: #28a745;">Online: ${scan.onlineCount}</div>
      <div class="stat-item" style="background: #dc3545;">Offline: ${scan.offlineCount}</div>
    `;
    
    const deviceList = document.createElement('div');
    deviceList.className = 'device-list';
    
    const devices = type === 'online' ? scan.onlineDevices : scan.offlineDevices;
    devices.forEach(device => {
      const deviceItem = document.createElement('div');
      deviceItem.className = `device-item device-${device.status}`;
      deviceItem.innerHTML = `
        <div><strong>${device.ip}</strong></div>
        <div>MAC: ${device.mac || 'Unknown'}</div>
        <div>Status: ${device.status}</div>
      `;
      deviceList.appendChild(deviceItem);
    });
    
    body.appendChild(stats);
    body.appendChild(deviceList);
    
    panel.appendChild(header);
    panel.appendChild(body);
    
    return panel;
  }

  function connect() {
    if (socket && socket.readyState === WebSocket.OPEN) {
      return;
    }

    try {
      socket = new WebSocket('ws://localhost:8080/ws');

      socket.onopen = function(event) {
        updateStatus(true);
      };

      socket.onmessage = function(event) {
        try {
          const parsed = JSON.parse(event.data);
          
          if (parsed.type === 'response' && parsed.response && parsed.response.result) {
            addScanToHistory(parsed.response.result);
          }
        } catch (e) {
          console.error('Error parsing response:', e);
        }
      };

      socket.onerror = function(error) {
        console.error('WebSocket error:', error);
      };

      socket.onclose = function(event) {
        updateStatus(false);
      };

    } catch (error) {
      console.error('Connection failed:', error);
    }
  }

  function disconnect() {
    if (socket) {
      socket.close(1000, 'User disconnected');
      socket = null;
    }
  }

  function startScan() {
    if (!socket || socket.readyState !== WebSocket.OPEN) {
      alert('‚ùå Not connected to WebSocket');
      return;
    }

    const interfaceName = interfaceSelect.value;
    const ipRange = ipRangeInput.value.trim();

    if (!ipRange) {
      alert('‚ùå IP range is required');
      return;
    }

    const request = {
      type: "request",
      request: {
        scanner_service: "arp_service",
        options: {
          interface_name: interfaceName,
          ip_range: ipRange
        }
      }
    };

    try {
      socket.send(JSON.stringify(request));
      scanBtn.textContent = 'Scanning...';
      scanBtn.disabled = true;
      
      setTimeout(() => {
        scanBtn.textContent = 'Start Scan';
        scanBtn.disabled = false;
      }, 10000);
      
    } catch (error) {
      alert('‚ùå Failed to send scan request: ' + error.message);
    }
  }

  function clearHistory() {
    scanHistory = [];
    updateHistoryDisplay();
  }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    function updateGlobalConnectionStatus() {
      const globalStatus = document.getElementById('connectionStatus');
      const isConnected = (socket && socket.readyState === WebSocket.OPEN) || 
                         (socketIcmp && socketIcmp.readyState === WebSocket.OPEN) ||
                         (socketNmap && socketNmap.readyState === WebSocket.OPEN) ||
                         (socketTcp && socketTcp.readyState === WebSocket.OPEN);
      
      if (isConnected) {
        globalStatus.textContent = 'üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
        globalStatus.className = 'connection-status connected';
      } else {
        globalStatus.textContent = 'üî¥ –û—Ç–∫–ª—é—á–µ–Ω–æ';
        globalStatus.className = 'connection-status disconnected';
      }
    }

    // ICMP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
    const statusElementIcmp = document.getElementById('statusIcmp');
    const disconnectBtnIcmp = document.getElementById('disconnectBtnIcmp');
    const scanBtnIcmp = document.getElementById('scanBtnIcmp');
    const targetsInput = document.getElementById('targetsInput');
    const pingCountSelect = document.getElementById('pingCountSelect');
    const icmpResults = document.getElementById('icmpResults');

    function updateIcmpStatus(connected) {
      if (connected) {
        statusElementIcmp.textContent = '‚úÖ Connected to WebSocket';
        statusElementIcmp.className = 'status connected';
        disconnectBtnIcmp.disabled = false;
        scanBtnIcmp.disabled = false;
      } else {
        statusElementIcmp.textContent = '‚ùå Disconnected';
        statusElementIcmp.className = 'status disconnected';
        disconnectBtnIcmp.disabled = true;
        scanBtnIcmp.disabled = true;
      }
      updateGlobalConnectionStatus();
    }

    function connectIcmp() {
      if (socketIcmp && socketIcmp.readyState === WebSocket.OPEN) {
        return;
      }

      try {
        socketIcmp = new WebSocket('ws://localhost:8080/ws');

        socketIcmp.onopen = function(event) {
          updateIcmpStatus(true);
        };

        socketIcmp.onmessage = function(event) {
          try {
            console.log('ICMP WebSocket message received:', event.data);
            const parsed = JSON.parse(event.data);
            console.log('ICMP parsed message:', parsed);
            
            if (parsed.type === 'response' && parsed.response && parsed.response.result) {
              console.log('ICMP calling addIcmpToHistory with:', parsed.response.result);
              addIcmpToHistory(parsed.response.result);
            } else {
              console.log('ICMP message does not match expected format');
            }
          } catch (e) {
            console.error('Error parsing ICMP response:', e);
          }
        };

        socketIcmp.onerror = function(error) {
          console.error('ICMP WebSocket error:', error);
        };

        socketIcmp.onclose = function(event) {
          updateIcmpStatus(false);
        };

      } catch (error) {
        console.error('ICMP connection failed:', error);
      }
    }

    function disconnectIcmp() {
      if (socketIcmp) {
        socketIcmp.close(1000, 'User disconnected');
        socketIcmp = null;
      }
    }

    function startIcmpScan() {
      if (!socketIcmp || socketIcmp.readyState !== WebSocket.OPEN) {
        alert('‚ùå Not connected to WebSocket');
        return;
      }

      const targetsText = targetsInput.value.trim();
      const pingCount = parseInt(pingCountSelect.value);

      if (!targetsText) {
        alert('‚ùå Targets are required');
        return;
      }

      const targets = targetsText
        .split('\n')
        .map(target => target.trim())
        .filter(target => target.length > 0);

      if (targets.length === 0) {
        alert('‚ùå Please enter at least one target');
        return;
      }

      const request = {
        type: "request",
        request: {
          scanner_service: "icmp_service",
          options: {
            targets: targets,
            ping_count: pingCount
          }
        }
      };

      try {
        socketIcmp.send(JSON.stringify(request));
        scanBtnIcmp.textContent = 'Pinging...';
        scanBtnIcmp.disabled = true;
        
        setTimeout(() => {
          scanBtnIcmp.textContent = 'Start Ping';
          scanBtnIcmp.disabled = false;
        }, 15000);
        
      } catch (error) {
        alert('‚ùå Failed to send ping request: ' + error.message);
      }
    }

    function addQuickTarget(target) {
      const currentValue = targetsInput.value.trim();
      if (currentValue) {
        targetsInput.value = currentValue + '\n' + target;
      } else {
        targetsInput.value = target;
      }
    }

    function addIcmpToHistory(result) {
      console.log('addIcmpToHistory called with:', result);
      console.log('result.results:', result.results);
      const timestamp = new Date().toLocaleTimeString();
      const scanId = Date.now();
      
      const pingResult = {
        id: scanId,
        timestamp: timestamp,
        results: result.results || [],
        totalTargets: result.results ? result.results.length : 0
      };
      
      console.log('Created pingResult:', pingResult);
      
      icmpHistory.unshift(pingResult);
      if (icmpHistory.length > 10) icmpHistory.pop();
      
      console.log('ICMP history length:', icmpHistory.length);
      updateIcmpHistoryDisplay();
    }

    function updateIcmpHistoryDisplay() {
      icmpResults.innerHTML = '';
      
      if (icmpHistory.length === 0) {
        icmpResults.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">No ping results yet</p>';
        return;
      }
      
      icmpHistory.forEach((ping, index) => {
        const pingPanel = createIcmpResultPanel(ping);
        icmpResults.appendChild(pingPanel);
      });
    }

    function createIcmpResultPanel(ping) {
      const panel = document.createElement('div');
      panel.className = 'scan-result';
      
      const header = document.createElement('div');
      header.className = 'scan-header';
      header.innerHTML = `
        <div>üì° ${ping.timestamp} - ${ping.totalTargets} targets</div>
      `;
      
      const body = document.createElement('div');
      body.className = 'scan-body';
      
      const deviceList = document.createElement('div');
      deviceList.className = 'device-list';
      
      ping.results.forEach(result => {
        const deviceItem = document.createElement('div');
        const isSuccess = result.packets_received > 0;
        deviceItem.className = `device-item ${isSuccess ? 'device-online' : 'device-offline'}`;
        
        const packetLoss = result.packet_loss_percent || 0;
        deviceItem.innerHTML = `
          <div><strong>${result.target}</strong> (${result.address})</div>
          <div>Packets: ${result.packets_received || 0}/${result.packets_sent || 0}</div>
          <div>Loss: ${packetLoss.toFixed(1)}%</div>
          ${result.error ? `<div style="color: #dc3545;">Error: ${result.error}</div>` : ''}
        `;
        deviceList.appendChild(deviceItem);
      });
      
      body.appendChild(deviceList);
      
      panel.appendChild(header);
      panel.appendChild(body);
      
      return panel;
    }

    function clearIcmpHistory() {
      icmpHistory = [];
      updateIcmpHistoryDisplay();
  }

  // Hotkeys
  document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.key === 'Enter') {
        const activePage = document.querySelector('.page.active').id;
        if (activePage === 'arp') {
      startScan();
        } else if (activePage === 'icmp') {
          startIcmpScan();
        } else if (activePage === 'nmap') {
          startNmapScan();
        } else if (activePage === 'tcp') {
          startTcpScan();
        }
      }
    });

    // ===== TCP –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ =====

    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket –¥–ª—è TCP
    function connectTcp() {
      if (socketTcp && socketTcp.readyState === WebSocket.OPEN) {
        return;
      }

      socketTcp = new WebSocket('ws://localhost:8080/ws');

      socketTcp.onopen = function(event) {
        updateTcpStatus(true);
      };

      socketTcp.onmessage = function(event) {
        try {
          console.log('TCP WebSocket message received:', event.data);
          const parsed = JSON.parse(event.data);
          console.log('TCP parsed message:', parsed);
          
          if (parsed.type === 'response' && parsed.response && parsed.response.result) {
            console.log('TCP calling addTcpToHistory with:', parsed.response.result);
            addTcpToHistory(parsed.response.result);
            
            const scanBtn = document.getElementById('scanBtnTcp');
            if (scanBtn) {
              scanBtn.textContent = 'Start Scan';
              scanBtn.disabled = false;
            }
          }
        } catch (e) {
          console.error('Error parsing TCP response:', e);
          const scanBtn = document.getElementById('scanBtnTcp');
          if (scanBtn) {
            scanBtn.textContent = 'Start Scan';
            scanBtn.disabled = false;
          }
        }
      };

      socketTcp.onerror = function(error) {
        console.error('TCP WebSocket error:', error);
      };

      socketTcp.onclose = function(event) {
        updateTcpStatus(false);
      };
    }

    // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç WebSocket –¥–ª—è TCP
    function disconnectTcp() {
      if (socketTcp) {
        socketTcp.close();
        socketTcp = null;
        updateTcpStatus(false);
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è TCP
    function updateTcpStatus(connected) {
      const status = document.getElementById('statusTcp');
      const connectBtn = document.querySelector('button[onclick="connectTcp()"]');
      const disconnectBtn = document.getElementById('disconnectBtnTcp');
      const scanBtn = document.getElementById('scanBtnTcp');

      if (connected) {
        status.textContent = 'Connected';
        status.className = 'status connected';
        connectBtn.disabled = true;
        disconnectBtn.disabled = false;
        scanBtn.disabled = false;
      } else {
        status.textContent = 'Disconnected';
        status.className = 'status disconnected';
        connectBtn.disabled = false;
        disconnectBtn.disabled = true;
        scanBtn.disabled = true;
      }
      
      updateGlobalConnectionStatus();
    }

    // –ó–∞–ø—É—Å–∫ TCP —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    function startTcpScan() {
      if (!socketTcp || socketTcp.readyState !== WebSocket.OPEN) {
        alert('Please connect first');
        return;
      }

      const targetHost = document.getElementById('targetHostTcp').value.trim();
      const targetPort = document.getElementById('targetPortTcp').value.trim();
      
      if (!targetHost) {
        alert('Please enter target host');
        return;
      }
      if (!targetPort) {
        alert('Please enter port');
        return;
      }

      const scanBtn = document.getElementById('scanBtnTcp');
      scanBtn.textContent = 'Scanning...';
      scanBtn.disabled = true;

      const request = {
        type: "request",
        request: {
          scanner_service: "tcp_service",
          options: {
            host: targetHost,
            port: targetPort
          }
        }
      };

      try {
        console.log('Sending TCP request:', JSON.stringify(request, null, 2));
        socketTcp.send(JSON.stringify(request));
        
        setTimeout(() => {
          scanBtn.textContent = 'Start Scan';
          scanBtn.disabled = false;
        }, 30000);
        
      } catch (error) {
        console.error('Error sending TCP request:', error);
        scanBtn.textContent = 'Start Scan';
        scanBtn.disabled = false;
      }
    }

    // –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ö–æ—Å—Ç–∞ –∏ –ø–æ—Ä—Ç–∞
    function setQuickTcp(host, port) {
      document.getElementById('targetHostTcp').value = host;
      document.getElementById('targetPortTcp').value = port;
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ TCP –≤ –∏—Å—Ç–æ—Ä–∏—é
    function addTcpToHistory(result) {
      console.log('addTcpToHistory called with:', result);
      const timestamp = new Date().toLocaleTimeString();
      const scanId = Date.now();
      
      const tcpResult = {
        id: scanId,
        timestamp: timestamp,
        result: result
      };
      
      console.log('Created tcpResult:', tcpResult);
      
      tcpHistory.unshift(tcpResult);
      if (tcpHistory.length > 10) tcpHistory.pop();
      
      console.log('TCP history length:', tcpHistory.length);
      updateTcpHistoryDisplay();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ TCP
    function updateTcpHistoryDisplay() {
      const tcpResults = document.getElementById('tcpResults');
      tcpResults.innerHTML = '';
      
      if (tcpHistory.length === 0) {
        tcpResults.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">No TCP scan results yet</p>';
        return;
      }
      
      tcpHistory.forEach((scan, index) => {
        const resultPanel = createTcpResultPanel(scan);
        tcpResults.appendChild(resultPanel);
      });
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ TCP
    function createTcpResultPanel(scan) {
      const panel = document.createElement('div');
      panel.className = 'scan-result';
      
      const header = document.createElement('div');
      header.className = 'scan-header';
      header.innerHTML = `
        <div>üîå ${scan.timestamp}</div>
      `;
      
      const body = document.createElement('div');
      body.className = 'scan-body';
      
      const result = scan.result;
      const status = result.status || 'unknown';
      const decodedText = result.decoded_text || result.DecodedText || '';
      const hexObjectKey = result.hex_object_key || result.HexObjectKey || '';
      const host = result.host || result.Host || '';
      const port = result.port || result.Port || '';
      const error = result.error || result.Error || '';
      
      body.innerHTML = `
        <div><strong>Host:</strong> ${host}:${port}</div>
        <div><strong>Status:</strong> <span style="color: ${status === 'completed' ? 'green' : 'red'}">${status}</span></div>
        ${hexObjectKey ? `<div><strong>Hex Object Key:</strong> ${hexObjectKey}</div>` : ''}
        ${decodedText ? `<div style="margin-top: 10px;"><strong>Decoded Text:</strong></div>
        <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 5px; font-family: monospace; white-space: pre-wrap; word-break: break-all;">${decodedText}</div>` : ''}
        ${error ? `<div style="color: red; margin-top: 10px;"><strong>Error:</strong> ${error}</div>` : ''}
      `;
      
      panel.appendChild(header);
      panel.appendChild(body);
      
      return panel;
    }

    // TCP History Functions
    function viewTcpHistory() {
      showPage('tcp-history');
      loadTcpHistory();
    }

    function loadTcpHistory() {
      fetch('/api/history/tcp')
        .then(response => response.json())
        .then(data => {
          console.log('TCP History data:', data);
          if (data.success) {
            displayTcpHistory(data.data || []);
          } else {
            document.getElementById('tcpHistoryContent').innerHTML = 
              `<p style="text-align: center; color: #dc3545; margin-top: 50px;">Error: ${data.error || 'Unknown error'}</p>`;
          }
        })
        .catch(error => {
          console.error('Error loading TCP history:', error);
          document.getElementById('tcpHistoryContent').innerHTML = 
            `<p style="text-align: center; color: #dc3545; margin-top: 50px;">Failed to load history: ${error.message}</p>`;
        });
    }

    function displayTcpHistory(records) {
      const content = document.getElementById('tcpHistoryContent');
      console.log('Displaying TCP history, records:', records);
      
      if (!records || !Array.isArray(records) || records.length === 0) {
        content.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px; padding: 20px;">No TCP scan history found</p>';
        return;
      }

      let html = '';
      records.forEach(record => {
        const date = record.created_at ? new Date(record.created_at).toLocaleString() : 'N/A';
        html += `
          <div class="history-item" style="border: 1px solid #ddd; margin: 0; padding: 15px; border-radius: 0; background: #f9f9f9; border-top: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <strong>Task ID: ${record.task_id || 'N/A'}</strong>
              <span style="color: #666; font-size: 12px;">${date}</span>
            </div>
            <div style="margin-bottom: 10px;">
              <strong>Target:</strong> ${record.host || 'N/A'}:${record.port || 'N/A'} | 
              <strong>Status:</strong> <span style="color: ${record.status === 'completed' ? 'green' : 'red'}">${record.status || 'unknown'}</span>
            </div>
            ${record.hex_object_key ? `<div style="margin-bottom: 10px;"><strong>Hex Object Key:</strong> ${record.hex_object_key}</div>` : ''}
            ${record.decoded_text ? `<div style="margin-bottom: 10px;"><strong>Decoded Text:</strong></div>
            <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; word-break: break-all; max-height: 300px; overflow-y: auto;">${record.decoded_text}</div>` : ''}
            ${record.error ? `<div style="color: red; margin-top: 10px;">Error: ${record.error}</div>` : ''}
          </div>
        `;
      });
      content.innerHTML = html;
    }

    function clearTcpHistory() {
      if (confirm('Are you sure you want to clear all TCP history?')) {
        fetch('/api/history/tcp/delete', { method: 'DELETE' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('TCP history cleared successfully');
              loadTcpHistory();
            } else {
              alert('Error: ' + data.error);
            }
          })
          .catch(error => {
            console.error('Error clearing TCP history:', error);
            alert('Failed to clear TCP history');
          });
      }
    }

    // ===== NMAP –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ =====

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–∏–ø–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    function initializeScanTypeCards() {
      const cards = document.querySelectorAll('.scan-type-card');
      cards.forEach(card => {
        card.addEventListener('click', function() {
          // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
          cards.forEach(c => c.classList.remove('active'));
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
          this.classList.add('active');
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∏–ø
          selectedScanType = this.dataset.type;
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä—Ç–æ–≤
          const portsSettings = document.getElementById('portsSettings');
          if (selectedScanType === 'tcp_scan' || selectedScanType === 'udp_scan') {
            portsSettings.style.display = 'block';
          } else {
            portsSettings.style.display = 'none';
          }
        });
      });
    }

    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket –¥–ª—è Nmap
    function connectNmap() {
      if (socketNmap && socketNmap.readyState === WebSocket.OPEN) {
        return;
      }

      socketNmap = new WebSocket('ws://localhost:8080/ws');

      socketNmap.onopen = function(event) {
        updateNmapStatus(true);
      };

      socketNmap.onmessage = function(event) {
        try {
          console.log('Nmap WebSocket message received:', event.data);
          const parsed = JSON.parse(event.data);
          console.log('Nmap parsed message:', parsed);
          
          if (parsed.type === 'response' && parsed.response && parsed.response.result) {
            console.log('Nmap calling addNmapToHistory with:', parsed.response.result);
            addNmapToHistory(parsed.response.result);
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            const scanBtn = document.getElementById('scanBtnNmap');
            console.log('Unlocking scan button, scanBtn:', scanBtn);
            if (scanBtn) {
              scanBtn.textContent = 'Start Scan';
              scanBtn.disabled = false;
              console.log('Scan button unlocked successfully');
            } else {
              console.error('Scan button not found!');
            }
          } else {
            console.log('Nmap message does not match expected format');
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –¥–∞–∂–µ –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π
            const scanBtn = document.getElementById('scanBtnNmap');
            if (scanBtn) {
              scanBtn.textContent = 'Start Scan';
              scanBtn.disabled = false;
              console.log('Scan button unlocked due to unexpected format');
            }
          }
        } catch (e) {
          console.error('Error parsing Nmap response:', e);
          
          // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
          const scanBtn = document.getElementById('scanBtnNmap');
          if (scanBtn) {
            scanBtn.textContent = 'Start Scan';
            scanBtn.disabled = false;
          }
        }
      };

      socketNmap.onerror = function(error) {
        console.error('Nmap WebSocket error:', error);
      };

      socketNmap.onclose = function(event) {
        updateNmapStatus(false);
      };
    }

    // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç WebSocket –¥–ª—è Nmap
    function disconnectNmap() {
      if (socketNmap) {
        socketNmap.close();
        socketNmap = null;
        updateNmapStatus(false);
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Nmap
    function updateNmapStatus(connected) {
      const status = document.getElementById('statusNmap');
      const connectBtn = document.querySelector('button[onclick="connectNmap()"]');
      const disconnectBtn = document.getElementById('disconnectBtnNmap');
      const scanBtn = document.getElementById('scanBtnNmap');

      if (connected) {
        status.textContent = 'Connected';
        status.className = 'status connected';
        connectBtn.disabled = true;
        disconnectBtn.disabled = false;
        scanBtn.disabled = false;
      } else {
        status.textContent = 'Disconnected';
        status.className = 'status disconnected';
        connectBtn.disabled = false;
        disconnectBtn.disabled = true;
        scanBtn.disabled = true;
      }
      
      updateGlobalConnectionStatus();
    }

    // –ó–∞–ø—É—Å–∫ Nmap —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    function startNmapScan() {
      if (!socketNmap || socketNmap.readyState !== WebSocket.OPEN) {
        alert('Please connect first');
        return;
      }

      if (!selectedScanType) {
        alert('Please select a scan type');
        console.log('selectedScanType is not set');
        return;
      }
      
      console.log('Selected scan type:', selectedScanType);

      const targetIP = document.getElementById('targetIPNmap').value.trim();
      if (!targetIP) {
        alert('Please enter target IP/host');
        return;
      }

      const scanBtn = document.getElementById('scanBtnNmap');
      scanBtn.textContent = 'Scanning...';
      scanBtn.disabled = true;

      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      let request;
      
      switch (selectedScanType) {
        case 'tcp_scan':
        case 'udp_scan':
          const ports = document.getElementById('portsInput').value.trim() || '80,443,22,21';
          request = {
            type: "request",
            request: {
              scanner_service: "nmap_service",
              options: {
                scan_method: "tcp_udp_scan",
                ip: targetIP,
                ports: ports,
                scanner_type: selectedScanType
              }
            }
          };
          break;
          
        case 'os_detection':
          request = {
            type: "request",
            request: {
              scanner_service: "nmap_service",
              options: {
                scan_method: "os_detection",
                ip: targetIP
              }
            }
          };
          break;
          
        case 'host_discovery':
          request = {
            type: "request",
            request: {
              scanner_service: "nmap_service",
              options: {
                scan_method: "host_discovery",
                ip: targetIP
              }
            }
          };
          break;
          
        default:
          alert('Invalid scan type');
          scanBtn.textContent = 'Start Scan';
          scanBtn.disabled = false;
          return;
      }

      try {
        console.log('Sending Nmap request:', JSON.stringify(request, null, 2));
        socketNmap.send(JSON.stringify(request));
        
        setTimeout(() => {
          scanBtn.textContent = 'Start Scan';
          scanBtn.disabled = false;
        }, 30000);
        
      } catch (error) {
        console.error('Error sending Nmap request:', error);
        scanBtn.textContent = 'Start Scan';
        scanBtn.disabled = false;
      }
    }

    // –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ä—Ç–æ–≤
    function setQuickPorts(type) {
      const portsInput = document.getElementById('portsInput');
      
      switch (type) {
        case 'common':
          portsInput.value = '22,23,25,53,80,110,143,443,993,995';
          break;
        case 'web':
          portsInput.value = '80,443,8080,8443,8000,3000';
          break;
        case 'all':
          portsInput.value = '1-65535';
          break;
      }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ Nmap –≤ –∏—Å—Ç–æ—Ä–∏—é
    function addNmapToHistory(result) {
      console.log('addNmapToHistory called with:', result);
      const timestamp = new Date().toLocaleTimeString();
      const scanId = Date.now();
      
      const nmapResult = {
        id: scanId,
        timestamp: timestamp,
        scanType: selectedScanType,
        result: result
      };
      
      console.log('Created nmapResult:', nmapResult);
      
      nmapHistory.unshift(nmapResult);
      if (nmapHistory.length > 10) nmapHistory.pop();
      
      console.log('Nmap history length:', nmapHistory.length);
      updateNmapHistoryDisplay();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ Nmap
    function updateNmapHistoryDisplay() {
      const nmapResults = document.getElementById('nmapResults');
      nmapResults.innerHTML = '';
      
      if (nmapHistory.length === 0) {
        nmapResults.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px;">No scan results yet</p>';
        return;
      }
      
      nmapHistory.forEach((scan, index) => {
        const resultPanel = createNmapResultPanel(scan);
        nmapResults.appendChild(resultPanel);
      });
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ Nmap
    function createNmapResultPanel(scan) {
      const panel = document.createElement('div');
      panel.className = 'scan-panel';
      
      const header = document.createElement('div');
      header.className = 'scan-header';
      header.innerHTML = `
        <div class="scan-info">
          <span class="scan-time">${scan.timestamp}</span>
          <span class="scan-type">${scan.scanType.replace('_', ' ').toUpperCase()}</span>
        </div>
      `;
      
      const body = document.createElement('div');
      body.className = 'scan-body';
      
      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      if (scan.scanType === 'tcp_scan' || scan.scanType === 'udp_scan') {
        // TCP/UDP —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        if (scan.result.port_info && scan.result.port_info.length > 0) {
          const portInfo = scan.result.port_info[0];
          console.log('Port info received:', portInfo);
          const ports = portInfo.AllPorts || portInfo.all_ports || [];
          const protocols = portInfo.Protocols || portInfo.protocols || [];
          const states = portInfo.State || portInfo.state || [];
          const services = portInfo.ServiceName || portInfo.service_name || [];
          console.log('Parsed data:', { ports, protocols, states, services });
          
          let portsDetails = '';
          if (ports.length > 0) {
            portsDetails = '<div style="margin-top: 10px;"><strong>Port Details:</strong><ul style="margin: 5px 0; padding-left: 20px;">';
            for (let i = 0; i < ports.length; i++) {
              const port = ports[i];
              const protocol = protocols[i] || 'unknown';
              const state = states[i] || 'unknown';
              const service = services[i] || 'unknown';
              portsDetails += `<li><strong>${port}/${protocol}</strong> - ${state} (${service})</li>`;
            }
            portsDetails += '</ul></div>';
          }
          
          body.innerHTML = `
            <div><strong>Host:</strong> ${scan.result.host || 'Unknown'}</div>
            <div><strong>Status:</strong> ${scan.result.status || 'Unknown'}</div>
            <div><strong>Ports found:</strong> ${ports.length}</div>
            ${ports.length > 0 ? 
              `<div><strong>Ports:</strong> ${ports.join(', ')}</div>` : ''}
            ${portsDetails}
          `;
        } else {
          body.innerHTML = `<div>No ports found</div>`;
        }
      } else if (scan.scanType === 'os_detection') {
        // OS Detection
        body.innerHTML = `
          <div><strong>Host:</strong> ${scan.result.host || 'Unknown'}</div>
          <div><strong>OS:</strong> ${scan.result.name || 'Unknown'}</div>
          <div><strong>Vendor:</strong> ${scan.result.vendor || 'Unknown'}</div>
          <div><strong>Family:</strong> ${scan.result.family || 'Unknown'}</div>
          <div><strong>Accuracy:</strong> ${scan.result.accuracy || 0}%</div>
        `;
      } else if (scan.scanType === 'host_discovery') {
        // Host Discovery
        const host = scan.result.Host || scan.result.host || 'Unknown';
        const status = scan.result.Status || scan.result.status || 'Unknown';
        const hostUp = scan.result.HostUP || scan.result.host_up || 0;
        const hostTotal = scan.result.HostTotal || scan.result.host_total || 0;
        const dns = scan.result.DNS || scan.result.dns;
        const reason = scan.result.Reason || scan.result.reason;
        
        body.innerHTML = `
          <div><strong>Host:</strong> ${host}</div>
          <div><strong>Status:</strong> ${status}</div>
          <div><strong>Up/Total:</strong> ${hostUp}/${hostTotal}</div>
          ${reason && reason !== 'unknown' ? `<div><strong>Reason:</strong> ${reason}</div>` : ''}
          ${dns && dns !== 'unknown' ? `<div><strong>DNS:</strong> ${dns}</div>` : ''}
        `;
      }
      
      panel.appendChild(header);
      panel.appendChild(body);
      
      return panel;
    }

    // –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ Nmap
    function clearNmapHistory() {
      nmapHistory = [];
      updateNmapHistoryDisplay();
    }

    // ==================== HISTORY FUNCTIONS ====================

    // ARP History Functions
    function viewARPHistory() {
      showPage('arp-history');
      loadARPHistory();
    }

    function loadARPHistory() {
      fetch('/api/history/arp')
        .then(response => response.json())
        .then(data => {
          console.log('ARP History data:', data);
          if (data.success) {
            displayARPHistory(data.data || []);
          } else {
            document.getElementById('arpHistoryContent').innerHTML = 
              `<p style="text-align: center; color: #dc3545; margin-top: 50px;">Error: ${data.error || 'Unknown error'}</p>`;
          }
        })
        .catch(error => {
          console.error('Error loading ARP history:', error);
          document.getElementById('arpHistoryContent').innerHTML = 
            `<p style="text-align: center; color: #dc3545; margin-top: 50px;">Failed to load history: ${error.message}</p>`;
        });
    }

    function displayARPHistory(records) {
      const content = document.getElementById('arpHistoryContent');
      console.log('Displaying ARP history, records:', records);
      
      if (!records || !Array.isArray(records) || records.length === 0) {
        content.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px; padding: 20px;">No ARP scan history found</p>';
        return;
      }

      let html = '';
      records.forEach(record => {
        const date = record.created_at ? new Date(record.created_at).toLocaleString() : 'N/A';
        const onlineDevices = Array.isArray(record.online_devices) ? record.online_devices : [];
        const offlineDevices = Array.isArray(record.offline_devices) ? record.offline_devices : [];
        
        let devicesHtml = '';
        if (onlineDevices.length > 0) {
          devicesHtml += '<div style="margin-top: 10px;"><strong style="color: #28a745;">üü¢ Online Devices:</strong><ul style="margin: 5px 0; padding-left: 20px;">';
          onlineDevices.forEach(device => {
            devicesHtml += `<li><strong>${device.ip || 'N/A'}</strong> - MAC: ${device.mac || 'Unknown'}</li>`;
          });
          devicesHtml += '</ul></div>';
        }
        
        if (offlineDevices.length > 0) {
          devicesHtml += '<div style="margin-top: 10px;"><strong style="color: #dc3545;">üî¥ Offline Devices:</strong><ul style="margin: 5px 0; padding-left: 20px;">';
          offlineDevices.forEach(device => {
            devicesHtml += `<li><strong>${device.ip || 'N/A'}</strong> - MAC: ${device.mac || 'Unknown'}</li>`;
          });
          devicesHtml += '</ul></div>';
        }
        
        html += `
          <div class="history-item" style="border: 1px solid #ddd; margin: 0; padding: 15px; border-radius: 0; background: #f9f9f9; border-top: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <strong>Task ID: ${record.task_id || 'N/A'}</strong>
              <span style="color: #666; font-size: 12px;">${date}</span>
            </div>
            <div style="margin-bottom: 10px;">
              <strong>Range:</strong> ${record.ip_range || 'N/A'} | 
              <strong>Interface:</strong> ${record.interface_name || 'N/A'} | 
              <strong>Status:</strong> <span style="color: ${record.status === 'completed' ? 'green' : 'red'}">${record.status || 'unknown'}</span>
            </div>
            <div style="margin-bottom: 10px;">
              <strong>Total:</strong> ${record.total_count || 0} | 
              <strong>Online:</strong> ${record.online_count || 0} | 
              <strong>Offline:</strong> ${record.offline_count || 0}
            </div>
            ${devicesHtml}
            ${record.error ? `<div style="color: red; margin-top: 10px;">Error: ${record.error}</div>` : ''}
          </div>
        `;
      });
      content.innerHTML = html;
    }

    function clearARPHistory() {
      if (confirm('Are you sure you want to clear all ARP history?')) {
        fetch('/api/history/arp/delete', { method: 'DELETE' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('ARP history cleared successfully');
              loadARPHistory();
            } else {
              alert('Error: ' + data.error);
            }
          })
          .catch(error => {
            console.error('Error clearing ARP history:', error);
            alert('Failed to clear ARP history');
          });
      }
    }

    // ICMP History Functions
    function viewICMPHistory() {
      showPage('icmp-history');
      loadICMPHistory();
    }

    function loadICMPHistory() {
      fetch('/api/history/icmp')
        .then(response => response.json())
        .then(data => {
          console.log('ICMP History data:', data);
          if (data.success) {
            displayICMPHistory(data.data || []);
          } else {
            document.getElementById('icmpHistoryContent').innerHTML = 
              `<p style="text-align: center; color: #dc3545; margin-top: 50px;">Error: ${data.error || 'Unknown error'}</p>`;
          }
        })
        .catch(error => {
          console.error('Error loading ICMP history:', error);
          document.getElementById('icmpHistoryContent').innerHTML = 
            `<p style="text-align: center; color: #dc3545; margin-top: 50px;">Failed to load history: ${error.message}</p>`;
        });
    }

    function displayICMPHistory(records) {
      const content = document.getElementById('icmpHistoryContent');
      console.log('Displaying ICMP history, records:', records);
      
      if (!records || !Array.isArray(records) || records.length === 0) {
        content.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px; padding: 20px;">No ICMP ping history found</p>';
        return;
      }

      let html = '';
      records.forEach(record => {
        const date = record.created_at ? new Date(record.created_at).toLocaleString() : 'N/A';
        const targets = Array.isArray(record.targets) ? record.targets.join(', ') : (record.targets || 'N/A');
        const results = Array.isArray(record.results) ? record.results : [];
        
        let resultsHtml = '';
        if (results.length > 0) {
          resultsHtml += '<div style="margin-top: 10px;"><strong>üìä Ping Results:</strong><ul style="margin: 5px 0; padding-left: 20px;">';
          results.forEach(result => {
            const isSuccess = result.packets_received > 0;
            const packetLoss = result.packet_loss_percent || 0;
            resultsHtml += `<li style="margin: 5px 0;">
              <strong>${result.target || 'N/A'}</strong> (${result.address || 'N/A'}) - 
              Packets: ${result.packets_received || 0}/${result.packets_sent || 0} - 
              Loss: ${packetLoss.toFixed(1)}% 
              <span style="color: ${isSuccess ? 'green' : 'red'};">${isSuccess ? '‚úÖ' : '‚ùå'}</span>
              ${result.error ? `<br><span style="color: red; font-size: 11px;">Error: ${result.error}</span>` : ''}
            </li>`;
          });
          resultsHtml += '</ul></div>';
        }
        
        html += `
          <div class="history-item" style="border: 1px solid #ddd; margin: 0; padding: 15px; border-radius: 0; background: #f9f9f9; border-top: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <strong>Task ID: ${record.task_id || 'N/A'}</strong>
              <span style="color: #666; font-size: 12px;">${date}</span>
            </div>
            <div style="margin-bottom: 10px;">
              <strong>Targets:</strong> ${targets} | 
              <strong>Ping Count:</strong> ${record.ping_count || 0} | 
              <strong>Status:</strong> <span style="color: ${record.status === 'completed' ? 'green' : 'red'}">${record.status || 'unknown'}</span>
            </div>
            <div style="margin-bottom: 10px;">
              <strong>Results:</strong> ${results.length} targets scanned
            </div>
            ${resultsHtml}
            ${record.error ? `<div style="color: red; margin-top: 10px;">Error: ${record.error}</div>` : ''}
          </div>
        `;
      });
      content.innerHTML = html;
    }

    function clearICMPHistory() {
      if (confirm('Are you sure you want to clear all ICMP history?')) {
        fetch('/api/history/icmp/delete', { method: 'DELETE' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('ICMP history cleared successfully');
              loadICMPHistory();
            } else {
              alert('Error: ' + data.error);
            }
          })
          .catch(error => {
            console.error('Error clearing ICMP history:', error);
            alert('Failed to clear ICMP history');
          });
      }
    }

    // Nmap History Functions
    function viewNmapHistory() {
      showPage('nmap-history');
      loadNmapHistory();
    }

    function loadNmapHistory() {
      fetch('/api/history/nmap')
        .then(response => response.json())
        .then(data => {
          console.log('Nmap History data:', data);
          if (data.success) {
            displayNmapHistory(data.data || {});
          } else {
            document.getElementById('nmapHistoryContent').innerHTML = 
              `<p style="text-align: center; color: #dc3545; margin-top: 50px;">Error: ${data.error || 'Unknown error'}</p>`;
          }
        })
        .catch(error => {
          console.error('Error loading Nmap history:', error);
          document.getElementById('nmapHistoryContent').innerHTML = 
            `<p style="text-align: center; color: #dc3545; margin-top: 50px;">Failed to load history: ${error.message}</p>`;
        });
    }

    function displayNmapHistory(data) {
      const content = document.getElementById('nmapHistoryContent');
      console.log('Displaying Nmap history, data:', data);
      
      if (!data || (typeof data !== 'object') || (Array.isArray(data) && data.length === 0) || (!Array.isArray(data) && Object.keys(data).length === 0)) {
        content.innerHTML = '<p style="text-align: center; color: #666; margin-top: 50px; padding: 20px;">No Nmap scan history found</p>';
        return;
      }

      let html = '';

      // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—à–ª–∏ –∫–∞–∫ –º–∞—Å—Å–∏–≤, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏—Ö
      if (Array.isArray(data) && data.length > 0) {
        html += '<h3 style="color: #007bff; margin: 20px 0 10px 0;">üìã Nmap Scans</h3>';
        data.forEach(record => {
          const date = record.created_at ? new Date(record.created_at).toLocaleString() : 'N/A';
          html += `
            <div class="history-item" style="border: 1px solid #ddd; margin: 0; padding: 15px; border-radius: 0; background: #f9f9f9; border-top: none;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <strong>Task ID: ${record.task_id || 'N/A'}</strong>
                <span style="color: #666; font-size: 12px;">${date}</span>
              </div>
              <div style="margin-bottom: 10px;">
                <strong>Target:</strong> ${record.ip || record.host || 'N/A'} | 
                <strong>Type:</strong> ${record.scanner_type || record.type || 'N/A'} | 
                <strong>Status:</strong> <span style="color: ${record.status === 'completed' ? 'green' : 'red'}">${record.status || 'unknown'}</span>
              </div>
              ${record.error ? `<div style="color: red;">Error: ${record.error}</div>` : ''}
            </div>
          `;
        });
        content.innerHTML = html;
        return;
      }

      // TCP/UDP Scans
      if (data.tcp_udp && Array.isArray(data.tcp_udp) && data.tcp_udp.length > 0) {
        html += '<h3 style="color: #007bff; margin: 20px 0 10px 0;">üîå TCP/UDP Scans</h3>';
        data.tcp_udp.forEach(record => {
          const date = record.created_at ? new Date(record.created_at).toLocaleString() : 'N/A';
          const target = record.ip || record.host || record.target || 'N/A';
          const scannerType = record.scanner_type || record.type || 'N/A';
          
          // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–æ—Ä—Ç—ã –∏–∑ port_info, –µ—Å–ª–∏ ports –Ω–µ —É–∫–∞–∑–∞–Ω
          let ports = record.ports || 'N/A';
          if (ports === 'N/A' && record.port_info) {
            if (Array.isArray(record.port_info) && record.port_info.length > 0) {
              const portInfo = record.port_info[0];
              if (portInfo.AllPorts && Array.isArray(portInfo.AllPorts) && portInfo.AllPorts.length > 0) {
                ports = portInfo.AllPorts.join(', ');
              } else if (portInfo.all_ports && Array.isArray(portInfo.all_ports) && portInfo.all_ports.length > 0) {
                ports = portInfo.all_ports.join(', ');
              }
            } else if (record.port_info.AllPorts && Array.isArray(record.port_info.AllPorts)) {
              ports = record.port_info.AllPorts.join(', ');
            } else if (record.port_info.all_ports && Array.isArray(record.port_info.all_ports)) {
              ports = record.port_info.all_ports.join(', ');
            }
          }
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ port_info
          let portInfoHtml = '';
          if (record.port_info) {
            let portInfoArray = [];
            if (Array.isArray(record.port_info)) {
              portInfoArray = record.port_info;
            } else if (record.port_info.Port || record.port_info.port) {
              portInfoArray = [record.port_info];
            }
            
            if (portInfoArray.length > 0) {
              portInfoHtml = '<div style="margin-top: 10px;"><strong>Port Details:</strong><ul style="margin: 5px 0; padding-left: 20px;">';
              portInfoArray.forEach(p => {
                const port = p.Port || p.port || 'N/A';
                const protocol = p.Protocol || p.protocol || 'tcp';
                const state = p.State || p.state || 'unknown';
                const service = p.Service || p.service || p.ServiceName || p.service_name || 'unknown service';
                portInfoHtml += `<li><strong>${port}/${protocol}</strong> - ${state} (${service})</li>`;
              });
              portInfoHtml += '</ul></div>';
            } else if (record.port_info.AllPorts || record.port_info.all_ports) {
              // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏
              const allPorts = record.port_info.AllPorts || record.port_info.all_ports || [];
              const protocols = record.port_info.Protocols || record.port_info.protocols || [];
              const states = record.port_info.State || record.port_info.state || [];
              const services = record.port_info.ServiceName || record.port_info.service_name || [];
              
              if (allPorts.length > 0) {
                portInfoHtml = '<div style="margin-top: 10px;"><strong>Port Details:</strong><ul style="margin: 5px 0; padding-left: 20px;">';
                for (let i = 0; i < allPorts.length; i++) {
                  const port = allPorts[i];
                  const protocol = protocols[i] || 'tcp';
                  const state = states[i] || 'unknown';
                  const service = services[i] || 'unknown service';
                  portInfoHtml += `<li><strong>${port}/${protocol}</strong> - ${state} (${service})</li>`;
                }
                portInfoHtml += '</ul></div>';
              }
            }
          }
          
          html += `
            <div class="history-item" style="border: 1px solid #ddd; margin: 0; padding: 15px; border-radius: 0; background: #f9f9f9; border-top: none;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <strong>Task ID: ${record.task_id || 'N/A'}</strong>
                <span style="color: #666; font-size: 12px;">${date}</span>
              </div>
              <div style="margin-bottom: 10px;">
                <strong>Target:</strong> ${target} | 
                <strong>Type:</strong> ${scannerType} | 
                <strong>Ports:</strong> ${ports} | 
                <strong>Status:</strong> <span style="color: ${record.status === 'completed' ? 'green' : 'red'}">${record.status || 'unknown'}</span>
              </div>
              ${portInfoHtml}
              ${record.error ? `<div style="color: red; margin-top: 10px;">Error: ${record.error}</div>` : ''}
            </div>
          `;
        });
      }

      // OS Detection Scans
      if (data.os_detection && Array.isArray(data.os_detection) && data.os_detection.length > 0) {
        html += '<h3 style="color: #28a745; margin: 20px 0 10px 0;">üñ•Ô∏è OS Detection Scans</h3>';
        data.os_detection.forEach(record => {
          const date = record.created_at ? new Date(record.created_at).toLocaleString() : 'N/A';
          const target = record.ip || record.host || 'N/A';
          const osName = record.name || 'Unknown';
          const accuracy = record.accuracy !== undefined ? record.accuracy : 'N/A';
          html += `
            <div class="history-item" style="border: 1px solid #ddd; margin: 0; padding: 15px; border-radius: 0; background: #f9f9f9; border-top: none;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <strong>Task ID: ${record.task_id || 'N/A'}</strong>
                <span style="color: #666; font-size: 12px;">${date}</span>
              </div>
              <div style="margin-bottom: 10px;">
                <strong>Target:</strong> ${target} | 
                <strong>OS:</strong> ${osName}${record.vendor ? ' (' + record.vendor + ')' : ''}${record.family ? ' - ' + record.family : ''} | 
                <strong>Accuracy:</strong> ${accuracy}% | 
                <strong>Status:</strong> <span style="color: ${record.status === 'completed' ? 'green' : 'red'}">${record.status || 'unknown'}</span>
              </div>
              ${record.error ? `<div style="color: red; margin-top: 10px;">Error: ${record.error}</div>` : ''}
            </div>
          `;
        });
      }

      // Host Discovery Scans
      if (data.host_discovery && Array.isArray(data.host_discovery) && data.host_discovery.length > 0) {
        html += '<h3 style="color: #ffc107; margin: 20px 0 10px 0;">üîç Host Discovery Scans</h3>';
        data.host_discovery.forEach(record => {
          const date = record.created_at ? new Date(record.created_at).toLocaleString() : 'N/A';
          const target = record.ip || record.host || record.target || 'N/A';
          const hostUp = record.host_up !== undefined ? record.host_up : 0;
          const hostTotal = record.host_total !== undefined ? record.host_total : 0;
          html += `
            <div class="history-item" style="border: 1px solid #ddd; margin: 0; padding: 15px; border-radius: 0; background: #f9f9f9; border-top: none;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <strong>Task ID: ${record.task_id || 'N/A'}</strong>
                <span style="color: #666; font-size: 12px;">${date}</span>
              </div>
              <div style="margin-bottom: 10px;">
                <strong>Target:</strong> ${target} | 
                <strong>Up/Total:</strong> ${hostUp}/${hostTotal} | 
                <strong>Status:</strong> <span style="color: ${record.status === 'completed' ? 'green' : 'red'}">${record.status || 'unknown'}</span>
                ${record.dns ? ` | <strong>DNS:</strong> ${record.dns}` : ''}
                ${record.reason ? ` | <strong>Reason:</strong> ${record.reason}` : ''}
              </div>
              ${record.error ? `<div style="color: red; margin-top: 10px;">Error: ${record.error}</div>` : ''}
            </div>
          `;
        });
      }

      content.innerHTML = html || '<p style="text-align: center; color: #666; margin-top: 50px;">No Nmap scan history found</p>';
    }

    function clearNmapHistory() {
      if (confirm('Are you sure you want to clear all Nmap history?')) {
        fetch('/api/history/nmap/delete', { method: 'DELETE' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Nmap history cleared successfully');
              loadNmapHistory();
            } else {
              alert('Error: ' + data.error);
            }
          })
          .catch(error => {
            console.error('Error clearing Nmap history:', error);
            alert('Failed to clear Nmap history');
          });
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      showPage('home');
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–∏–ø–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      initializeScanTypeCards();
  });
</script>
</body>
</html>